<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üå± BioBalance - Personalized Health AI</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: auto;
        }
        .card {
            border-radius: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            font-weight: 600;
        }
        .recommendation-list li {
            background: #f0f9ff;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Header -->
    <div class="text-center mb-4">
        <h1 class="text-success">üå± BioBalance</h1>
        <p class="text-muted">AI-powered personalized health & nutrition insights</p>
    </div>

    <!-- User Selector -->
    <div class="card p-4">
        <form method="get" class="row g-3 align-items-center">
            <div class="col-auto">
                <label for="user" class="col-form-label fw-bold">Select User:</label>
            </div>
            <div class="col-auto">
                <select id="user" name="user" class="form-select" onchange="this.form.submit()">
                    <option value="">-- Select --</option>
                    {% for u in users %}
                        <option value="{{ u }}" {% if selected_user == u %}selected{% endif %}>{{ u }}</option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>

    <div class="text-end mb-3">
    <a href="{% url 'add_data' %}" class="btn btn-primary">‚ûï Add Health Data</a>
    </div>


    {% if health_data %}
    <!-- Health Data Table -->
    <div class="card p-4">
        <h2 class="text-primary mb-3">üìä Health Data (Table)</h2>
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Date</th>
                        <th>Sleep (hrs)</th>
                        <th>Heart Rate</th>
                        <th>Stress</th>
                        <th>Glucose</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in health_data %}
                    <tr>
                        <td>{{ row.date }}</td>
                        <td>{{ row.sleep_hours }}</td>
                        <td>{{ row.heart_rate }}</td>
                        <td>{{ row.stress_level }}</td>
                        <td>{{ row.glucose }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>



    <!-- AI Recommendations -->
    <div class="card p-4">
        <h2 class="text-success mb-3">üìù AI Recommendations</h2>
        <ul class="recommendation-list list-unstyled">
            {% for r in recs %}
                <li>‚úÖ {{ r }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

      <!-- Chart Section -->
    <div class="card p-4">
        <h2 class="text-info mb-3">üìà Health Trends (Charts)</h2>
        <canvas id="healthChart"></canvas>
    </div>



</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% if health_data %}
<script>
    const labels = [{% for row in health_data %}"{{ row.date }}",{% endfor %}];

    const data = {
        labels: labels,
        datasets: [
            {
                label: 'Sleep (hrs)',
                data: [{% for row in health_data %}{{ row.sleep_hours }},{% endfor %}],
                borderColor: '#36a2eb',
                backgroundColor: 'rgba(54,162,235,0.2)',
                fill: true,
                tension: 0.3
            },
            {
                label: 'Heart Rate',
                data: [{% for row in health_data %}{{ row.heart_rate }},{% endfor %}],
                borderColor: '#ff6384',
                backgroundColor: 'rgba(255,99,132,0.2)',
                fill: true,
                tension: 0.3
            },
            {
                label: 'Stress Level',
                data: [{% for row in health_data %}{{ row.stress_level }},{% endfor %}],
                borderColor: '#ff9f40',
                backgroundColor: 'rgba(255,159,64,0.2)',
                fill: true,
                tension: 0.3
            },
            {
                label: 'Glucose',
                data: [{% for row in health_data %}{{ row.glucose }},{% endfor %}],
                borderColor: '#4bc0c0',
                backgroundColor: 'rgba(75,192,192,0.2)',
                fill: true,
                tension: 0.3
            }
        ]
    };

    const config = {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'User Health Trends Over Time' }
            }
        },
    };

    new Chart(document.getElementById('healthChart'), config);
</script>
{% endif %}
</body>
</html>
